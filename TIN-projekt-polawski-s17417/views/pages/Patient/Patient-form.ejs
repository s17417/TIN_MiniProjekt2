<%- include('../../fragments/header.ejs') %>

	<main>
		<script type="application/javascript" src="/js/validationPatientForm.js"></script>
		<h2><%= pageTitle %></h2>
		<form class="form" method="post" action="<%=formAction%>" novalidate onsubmit="return validateForm()">
			<fieldset>
				<legend>
					<%= pageTitle %>
				</legend>

				<input type="hidden" name="_id" value="<%= pat._id %>">

				<label for="firstname"> Imię:<sup>*</sup></label>
				<input type="text" name="firstname" id="firstname" placeholder="2-60 znaków"
					value="<%= pat.firstname %>" <%=(formMode=='showDetails' ) ? 'disabled' : '' %> />
				<span id="errorFirstname" class="errors-text"></span>

				<label for="surname"> Nazwisko:<sup>*</sup></label>
				<input type="text" name="surname" id="surname" placeholder="2-60 znaków" value="<%= pat.surname %>"
					<%=(formMode=='showDetails' ) ? 'disabled' : '' %> />
				<span id="errorSurname" class="errors-text"></span>

				<label for="birthdate">Data urodzenia:</label>
				<input type="date" id="birthdate" name="birthdate" min="1901-01-01"
					value="<%=pat.birthdate==null ? '' : pat.birthdate.toISOString().split('T')[0] %>" <%=(formMode=='showDetails' ) ? 'disabled'
					: '' %> />
				<span id="errorBirthdate" class="errors-text"></span>

				<label for="idnumber"> PESEL:</label>
				<input type="text" name="idnumber" id="idnumber" placeholder="11 znaków" value="<%= pat.idnumber %>"
					<%=(formMode=='showDetails' ) ? 'disabled' : '' %> />
				<span id="errorId" class="errors-text"></span>

				<label for="PatientComments"> Uwagi:</label>
				<textarea name="PatientComments" id="PatientComments" rows="10" cols="30"
					value="<%= pat.PatientComments %>" <%=(formMode=='showDetails' ) ? 'disabled' : '' %> />
			</textarea>

				<p id="errorSummary" class="errors-text"></p>
				<% if (formMode=='showDetails' ) { %>
					<div class="form-buttons">
						<a href="/patients/edit/<%= pat._id %>" class="form-button-edit">Edytuj</a>
						<a class="form-button-cancel" href="/patients">Powrót</a>
					</div>
				<% } else { %>
					<div class="form-buttons">
						<input type="submit" class="form-button-submit" value="<%=btnLabel%>" />
						<a class="form-button-cancel" href="/patients">Anuluj</a>
					</div>

				<% } %>


			</fieldset>
		</form>

		<% if (formMode=='showDetails' || formMode=='edit' ) { %>
			<h2>
				Lista zleconych badań
			</h2>
			<table class="table-list">
				<thead>
					<tr>
						<th>Badanie laboratoryjne</th>
						<th>Status</th>
						<th>Data zlecenia</th>
						<th>Data wyniku</th>
						<th>Wynik</th>
					</tr>
				</thead>
				<tbody>
					<% for (let e of pat.orders) { %>
						<tr>
							<td><a href="/labTests/details/<%= e.labTest._id %>">
									<%= e.labTest.name %>
								</a></td>
							<td>
								<%= e.status %>
							</td>
							<td>
								<%= e.orderDate==null ? '' : e.orderDate.toISOString().split('T')[0] %>
							</td>
							<td>
								<%= e.resultDate==null ? '' : e.resultDate.toISOString().split('T')[0] %>
							</td>
							<td>
								<%= e.resultValue==null ? '' : e.resultValue+' '+e.labTest.units%></td>
			</tr>
			<% } %>
		</tbody>
	</table>
	<% } %>



</main>

<%- include('../../fragments/footer.ejs') %>